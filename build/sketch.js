// Generated by CoffeeScript 1.10.0
var Compiler, File, MarkDownDriven, MassCompiler, Path, compiler, glob,
  hasProp = {}.hasOwnProperty;

MarkDownDriven = require("./");

File = require("fs");

Path = require("path");

glob = require("glob");

Compiler = (function() {
  Compiler.prototype.tokenizer = null;

  Compiler.prototype.converter = null;

  Compiler.prototype.parser = null;

  function Compiler(props) {
    var key, val;
    if (props == null) {
      props = {};
    }
    for (key in props) {
      if (!hasProp.call(props, key)) continue;
      val = props[key];
      this[key] = val;
    }
    if (this.tokenizer == null) {
      this.tokenizer = new MarkDownDriven.Tokenizer;
    }
    if (this.converter == null) {
      this.converter = new MarkDownDriven.JasmineConverter;
    }
    if (this.parser == null) {
      this.parser = new MarkDownDriven.JasmineCoffeeParser;
    }
  }

  Compiler.prototype.parse = function(markdown) {
    var tokens;
    tokens = this.tokenizer.tokenize(markdown);
    tokens = this.converter.convert(tokens);
    return this.parser.parse(tokens);
  };

  Compiler.prototype.readFile = function(path, done) {
    return require("fs").readFile(path, done);
  };

  Compiler.prototype.writeFile = function(path, data, done) {
    return require("fs").writeFile(path, data, done);
  };

  Compiler.prototype.compile = function(sourcePath, targetPath, done) {
    return this.readFile(sourcePath, (function(_this) {
      return function(error, data) {
        var compiled;
        if (error != null) {
          return done(error);
        }
        compiled = _this.parse(data.toString());
        return _this.writeFile(targetPath, compiled, done);
      };
    })(this));
  };

  return Compiler;

})();

MassCompiler = (function() {
  function MassCompiler(params) {
    var key, val;
    if (params == null) {
      params = {};
    }
    for (key in params) {
      if (!hasProp.call(params, key)) continue;
      val = params[key];
      this[key] = val;
    }
    if (this.cwd == null) {
      this.cwd = process.cwd();
    }
    if (this.compiler == null) {
      this.compiler = new Compiler;
    }
    if (this.sourceDir == null) {
      this.sourceDir = Path.resolve(this.cwd, "docs");
    }
    if (this.targetDir == null) {
      this.targetDir = Path.resolve(this.cwd, "spec");
    }
  }

  MassCompiler.prototype.getTargetName = function(sourceName) {
    return sourceName.replace(/((\.coffee)?\.md|\.litcoffee)$/, "-spec.coffee");
  };

  MassCompiler.prototype.compileSourceName = function(sourceName, done) {
    var sourcePath, targetName, targetPath;
    targetName = this.getTargetName(sourceName);
    sourcePath = Path.join(this.sourceDir, sourceName);
    targetPath = Path.join(this.targetDir, targetName);
    return this.compiler.compile(sourcePath, targetPath, done);
  };

  MassCompiler.prototype.eachSeries = function(series, fn, done) {
    return require("async").eachSeries(series, fn, done);
  };

  MassCompiler.prototype.compile = function(pattern, done) {
    if (pattern == null) {
      pattern = "**/*.?(md|litcoffee)";
    }
    return glob(pattern, {
      cwd: this.sourceDir
    }, (function(_this) {
      return function(error, sourceNames) {
        if (error) {
          return done(error);
        }
        return _this.eachSeries(sourceNames, _this.compileSourceName.bind(_this), done);
      };
    })(this));
  };

  return MassCompiler;

})();

compiler = new MassCompiler;

compiler.compile("**/*.?(md|litcoffee)", function(error) {
  if (error != null) {
    throw error;
  }
});

//# sourceMappingURL=sketch.js.map
